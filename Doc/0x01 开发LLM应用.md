# 0x01 开发LLM应用

## 什么是大模型开发

大模型开发是基于大型语言模型（LLM）的应用开发，侧重于利用LLM的理解与生成能力，结合特定数据和业务逻辑。技术核心在于调用API或开源模型，通过Prompt Engineering控制LLM，将大模型视为工程问题而非深度学习研究。

在开发中，我们通常不改变模型结构，而是作为工具使用，通过Prompt Engineering、数据工程和业务逻辑分解来发挥LLM的能力，适配任务需求。初学者应专注于掌握使用LLM的实践技巧，而非深入模型内部原理。

## 大模型开发的一般流程

![alt text](..\figure\0x01_Figure_00_LLM_developing_whole.png)

1. 确定目标：明确应用场景、目标用户和核心价值，从小规模MVP开始逐步完善。

2. 设计功能：确定核心功能，设计上下游功能，如个人知识库助手需设计上传和纠正功能。

3. 搭建架构：采用数据库+Prompt+大模型架构，推荐基于LangChain框架实现全流程贯通。

4. 搭建数据库：收集和预处理数据，使用向量数据库如Chroma进行存储，包括格式转换和数据清洗。

5. Prompt Engineering：构建优质Prompt提升性能，基于业务设计满足基本要求的Prompt。

6. 验证迭代：通过发现Bad Case改进Prompt，提升系统效果，应对边界情况。

7. 前后端搭建：使用Gradio和Streamlit快速搭建可视化页面，实现Demo上线。

8. 体验优化：上线后跟踪用户体验，记录反馈，针对性优化。

## 以知识库助手为例的流程简析

### 步骤一：项目规划与需求分析

1. 项目目标：基于个人知识库的问答助手

2. 核心功能

    * 将定期拉取Gitee / Github 上的 MarkDown 文件及向量化，并创建知识库；
    * 选择知识库，检索用户提问的知识片段；
    * 提供知识片段与提问，获取大模型回答；
    * 流式回复；
    * 历史对话记录

3. 确定技术架构和工具

    * 框架：LangChain
    * Embedding 模型：GPT、智谱、M3E
    * 数据库：Chroma
    * 大模型：GPT、GLM、Kimi 等
    * 前后端：Gradio 和 FastAPI

### 步骤二：数据准备与向量知识库构建

加载本地文档 -> 读取文本 -> 文本分割 -> 文本向量化 -> question 向量化 -> 在文本向量中匹配出与问句向量最相似的 top k 个 -> 匹配出的文本作为上下文和问题一起添加到 Prompt 中 -> 提交给 LLM 生成回答

![LangChain](..\figure\0x00_Figure_01_LANGCHAIN.png)

#### 1.搜集和整理文档

文档格式以 MD 为主，首先设置定时任务或者手动触发的任务使用 Git 拉取文档，然后使用 LangChain 的文档加载器模块加载文档。

由于存在 token 大小的限制，我们需要对读取的文本进行切分，切分后的一段文本就是一个单位的知识。

#### 2.将文档词向量化

使用文本嵌入(Embeddings)技术对分割后的文档进行向量化，使语义相似的文本片段具有接近的向量表示。然后，存入向量数据库，完成 索引(index) 的创建，实现快速检索。

#### 3.将向量化后的文档导入 Chroma 知识库，建立知识库索引

用户知识库内容通过Embedding存入向量数据库，用户提问同样Embedding后，使用向量相似度算法（如余弦相似度）匹配相关知识片段，将这些片段与问题作为Prompt输入LLM以生成回答。

### 步骤三：大模型集成与 API 连接

编写代码集成与不同的大模型 API 的交互。参考[0x02 LLM API详细用法的实例](./0x02%20LLM%20API详细用法的实例.md)

### 步骤四：核心功能实现

1. 构建 Prompt Engineering，实现大模型回答功能，根据用户提问和知识库内容生成回答。
2. 实现流式回复，允许用户进行多轮对话。
3. 添加历史对话记录功能，保存用户与助手的交互历史。

### 步骤五：核心功能迭代优化

1. 进行验证评估，收集 Bad Case。
2. 根据 Bad Case 迭代优化核心功能实现。

### 步骤六：前端与用户交互界面开发

1. 使用 Gradio 和 Streamlit 搭建前端界面。
2. 实现用户上传文档、创建知识库的功能。
3. 设计用户界面，包括问题输入、知识库选择、历史记录展示等。

### 步骤七：部署测试与上线

1. 部署问答助手到服务器或云平台，确保可在互联网上访问。
2. 进行生产环境测试，确保系统稳定。

### 步骤八：维护与持续改进

1. 监测系统性能和用户反馈，及时处理问题。
2. 定期更新知识库，添加新的文档和信息。
3. 收集用户需求，进行系统改进和功能扩展。
